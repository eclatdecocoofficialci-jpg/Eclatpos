<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Produits | √âclat de Coco POS</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- üíó Navigation -->
  <nav>
    <h2>√âclat de Coco POS</h2>
    <div class="nav-buttons">
      <a href="index.html">POS</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="sales.html">Sales Invoices</a>
      <a href="products.html" class="active">Products</a>
      <a href="inventory.html">Inventory</a>
      <a href="expenses.html">Expenses</a>
      <a href="reports.html">Reports</a>
    </div>
  </nav>

  <!-- üíÖ Main Layout -->
  <div class="product-layout">
    
    <!-- üå∏ Left Form -->
    <div class="add-product">
      <h3>Ajouter un Produit</h3>

      <label>Code Produit</label>
      <input type="text" id="code" placeholder="Auto" readonly>

      <label>Nom du Produit</label>
      <input type="text" id="name" placeholder="Ex: Savon Rose Vanille" oninput="autoGenerateCode()">

      <label>Cat√©gorie</label>
      <input type="text" id="category" placeholder="Ex: Savon" oninput="autoGenerateCode()">

      <label>Quantit√©</label>
      <input type="number" id="quantity" placeholder="Ex: 10">

      <label>Prix (FCFA)</label>
      <input type="number" id="price" placeholder="Ex: 2500">

      <label>Co√ªt (FCFA)</label>
      <input type="number" id="cost" placeholder="Ex: 1500">

      <label>Code-barres</label>
      <input type="text" id="barcode" placeholder="Auto" readonly>

      <button class="add-btn" onclick="addProduct()">‚ûï Ajouter Produit</button>
    </div>

    <!-- üßæ Right Table -->
    <div class="product-table">
      <h3>Liste des Produits</h3>
      <table id="product-table">
        <thead>
          <tr>
            <th>Code</th>
            <th>Nom</th>
            <th>Cat√©gorie</th>
            <th>Quantit√©</th>
            <th>Prix</th>
            <th>Co√ªt</th>
            <th>Barcode</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="product-table-body">
          <tr><td colspan="8">Aucun produit ajout√©</td></tr>
        </tbody>
      </table>
    </div>

  </div>

  <!-- üåº Script -->
  <script>
    const products = JSON.parse(localStorage.getItem('products')) || [];
    const tableBody = document.getElementById('product-table-body');

    // üßÅ Refresh Table
    function refreshTable() {
      if (products.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="8">Aucun produit ajout√©</td></tr>';
        return;
      }
      tableBody.innerHTML = '';
      products.forEach((p, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.quantity}</td>
          <td>${p.price?.toLocaleString()}</td>
          <td>${p.cost?.toLocaleString()}</td>
          <td>${p.barcode}</td>
          <td>
            <button onclick="editProduct(${index})">‚úèÔ∏è</button>
            <button onclick="deleteProduct(${index})">üóëÔ∏è</button>
          </td>`;
        tableBody.appendChild(tr);
      });
    }

    // üå∏ Auto Code + Barcode Generator
    function autoGenerateCode() {
      const category = document.getElementById('category').value.trim();
      const name = document.getElementById('name').value.trim();

      if (category.length < 2) return;

      const prefix = category.substring(0, 2).toUpperCase();
      const existing = products.filter(p => p.category?.substring(0, 2).toUpperCase() === prefix);
      const nextNum = String(existing.length + 1).padStart(3, '0');
      const code = prefix + nextNum;

      document.getElementById('code').value = code;

      // Auto barcode based on time + code
      if (name) {
        const barcode = Date.now().toString().slice(-6) + Math.floor(Math.random() * 90 + 10);
        document.getElementById('barcode').value = barcode;
      }
    }

    // ‚ûï Add Product
    function addProduct() {
      const code = document.getElementById('code').value;
      const name = document.getElementById('name').value.trim();
      const category = document.getElementById('category').value.trim();
      const quantity = parseInt(document.getElementById('quantity').value) || 0;
      const price = parseFloat(document.getElementById('price').value) || 0;
      const cost = parseFloat(document.getElementById('cost').value) || 0;
      const barcode = document.getElementById('barcode').value;

      if (!name || !category) {
        alert('Veuillez entrer un nom et une cat√©gorie.');
        return;
      }

      products.push({ code, name, category, quantity, price, cost, barcode });
      localStorage.setItem('products', JSON.stringify(products));

      document.querySelectorAll('.add-product input').forEach(i => i.value = '');
      refreshTable();
    }

    // ‚úèÔ∏è Edit Product
    function editProduct(index) {
      const newName = prompt("Modifier le nom du produit :", products[index].name);
      if (newName) {
        products[index].name = newName.trim();
        localStorage.setItem('products', JSON.stringify(products));
        refreshTable();
      }
    }

    // üóëÔ∏è Delete Product
    function deleteProduct(index) {
      if (confirm("Supprimer ce produit ?")) {
        products.splice(index, 1);
        localStorage.setItem('products', JSON.stringify(products));
        refreshTable();
      }
    }

    refreshTable();
  </script>
</body>
</html>
